# Common function to get sudo password securely
get_sudo_password() {
    echo "This script requires sudo privileges for system setup." >&2
    read -rs -p "Enter sudo password: " password
    echo >&2  # 改行
    echo "$password"
}

# Get password securely
password=$(get_sudo_password)
# Validate password by testing sudo access
if ! echo "$password" | sudo -S true 2>/dev/null; then
    echo "ERROR: Invalid sudo password" >&2
    exit 1
fi

# Extend sudo timeout for this session
echo "$password" | sudo -S -v
